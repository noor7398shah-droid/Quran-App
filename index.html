<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Al Musalimeen | Premium</title>

<script src="https://unpkg.com/lucide@latest"></script>

<style>
body { background:#062216; color:white; font-family:sans-serif; text-align:center; }

.download-btn {
background:#facc15;
color:black;
padding:15px 35px;
border-radius:40px;
text-decoration:none;
font-weight:bold;
display:inline-block;
margin-top:20px;
}

.feedback-box {
margin-top:50px;
}

input {
padding:8px;
border-radius:6px;
border:none;
margin:5px;
}

button {
padding:8px 15px;
border:none;
border-radius:6px;
cursor:pointer;
font-weight:bold;
}

.comment {
background:#113d2c;
padding:10px;
margin:8px auto;
max-width:400px;
border-radius:10px;
text-align:left;
position:relative;
animation: fadeIn 0.5s ease;
}

.delete-btn {
position:absolute;
right:10px;
top:10px;
background:red;
color:white;
font-size:12px;
padding:3px 6px;
border-radius:5px;
cursor:pointer;
display:none;
}

.admin-panel {
margin-top:20px;
}

@keyframes fadeIn {
from { opacity:0; transform:translateY(10px); }
to { opacity:1; transform:translateY(0); }
}
</style>
</head>

<body>

<h1>ðŸ“– Al Musalimeen</h1>

<a href="https://github.com/noor7398shah-droid/Quran-App/releases/latest/download/AlMusalimeen_latest.apk"
   class="download-btn" id="downloadBtn">
   Download APK
</a>

<p>Total Downloads: <span id="downloadCount">0</span></p>

<div class="feedback-box">
<h2>Leave Feedback</h2>

<input type="text" id="usernameInput" placeholder="Your Name">
<input type="text" id="feedbackInput" placeholder="Your Comment">
<button id="submitFeedback">Submit</button>

<div id="commentsList"></div>
</div>

<div class="admin-panel">
<h3>Admin Panel</h3>
<input type="password" id="adminPass" placeholder="Admin Password">
<button onclick="loginAdmin()">Login</button>
<p id="adminStatus"></p>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, increment, collection, addDoc, deleteDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCOiq6WTI-o0pZEZZgW_qmg6lV31X1EtoE",
  authDomain: "quran-app-46a14.firebaseapp.com",
  projectId: "quran-app-46a14",
  storageBucket: "quran-app-46a14.firebasestorage.app",
  messagingSenderId: "78951826879",
  appId: "1:78951826879:web:9c82b02b121915e6754d0a"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/////////////////////
// ADMIN
/////////////////////

let isAdmin = false;
const ADMIN_PASSWORD = "786786";

window.loginAdmin = function() {
const pass = document.getElementById("adminPass").value;
if(pass === ADMIN_PASSWORD){
isAdmin = true;
document.getElementById("adminStatus").innerText = "Admin Logged In";
loadComments();
}else{
alert("Wrong Password");
}
};

/////////////////////
// DOWNLOAD COUNTER
/////////////////////

const counterRef = doc(db, "appData", "downloads");

async function initCounter(){
const snap = await getDoc(counterRef);
if(!snap.exists()){
await setDoc(counterRef,{count:0});
}
}
initCounter();

onSnapshot(counterRef,(docSnap)=>{
if(docSnap.exists()){
document.getElementById("downloadCount").innerText = docSnap.data().count;
}
});

document.getElementById("downloadBtn").addEventListener("click",async ()=>{
await updateDoc(counterRef,{count: increment(1)});
});

/////////////////////
// SPAM PROTECTION
/////////////////////

let lastCommentTime = 0;

/////////////////////
// COMMENTS
/////////////////////

const commentsRef = collection(db,"comments");

document.getElementById("submitFeedback").addEventListener("click",async ()=>{
const name = document.getElementById("usernameInput").value.trim();
const text = document.getElementById("feedbackInput").value.trim();

if(name === "" || text === ""){
alert("Fill all fields");
return;
}

if(text.length > 200){
alert("Comment too long");
return;
}

const now = Date.now();
if(now - lastCommentTime < 5000){
alert("Wait 5 seconds before next comment");
return;
}
lastCommentTime = now;

await addDoc(commentsRef,{
name:name,
text:text,
time:now
});

document.getElementById("feedbackInput").value="";
});

function loadComments(){
const q = query(commentsRef, orderBy("time"));

onSnapshot(q,(snapshot)=>{
const list = document.getElementById("commentsList");
list.innerHTML="";

snapshot.forEach((docSnap)=>{
const data = docSnap.data();

const div = document.createElement("div");
div.className="comment";
div.innerHTML = "<strong>"+data.name+"</strong><br>"+data.text;

if(isAdmin){
const del = document.createElement("div");
del.className="delete-btn";
del.innerText="Delete";
del.style.display="block";
del.onclick = async ()=>{
await deleteDoc(doc(db,"comments",docSnap.id));
};
div.appendChild(del);
}

list.appendChild(div);
});

list.scrollTop = list.scrollHeight;
});
}

loadComments();

</script>

<script>
lucide.createIcons();
</script>

</body>
</html>
